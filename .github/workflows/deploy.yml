
name: PHP CI Pipeline - Build & Push Docker Image (Simplified) # Ù†Ø§Ù… Pipeline

on:
  push:
    branches:
      - master # Ø§Ø¬Ø±Ø§ÛŒ Pipeline ØªÙ†Ù‡Ø§ Ø¨Ø§ Push Ø¨Ù‡ Ø´Ø§Ø®Ù‡ master

env:
  # Ø³Ø§Ø®Øª ØªÚ¯ Ù†Ù‡Ø§ÛŒÛŒ ØªØµÙˆÛŒØ± Ø¯Ø± GHCR
  REPO_NAME: ${{ github.event.repository.name }} 
  # Ø¢Ø¯Ø±Ø³ ØªÚ¯: ghcr.io/username/repo-name/php:latest 
  PHP_IMAGE_TAG: ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}/php:latest 

jobs:
  # 1. Ù…Ø±Ø­Ù„Ù‡ CI: Ø³Ø§Ø®ØªØŒ ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ ØªØµÙˆÛŒØ± PHP Ø¨Ù‡ GHCR
  build-and-push-php:
    runs-on: ubuntu-latest # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÛŒÚ© Ù…Ø§Ø´ÛŒÙ† Ù…Ø¬Ø§Ø²ÛŒ Ù„ÛŒÙ†ÙˆÚ©Ø³
    
    # ğŸš¨ Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ (Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Push Ø¨Ù‡ GHCR)
    permissions:
      contents: read
      packages: write
      
    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v4 # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡

      - name: ğŸ”‘ Login to GHCR (GitHub Container Registry)
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }} # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¯Ø§Ø®Ù„ÛŒ
          password: ${{ secrets.GITHUB_TOKEN }} # ğŸ’¡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙˆÚ©Ù† Ø§Ù…Ù†ÛŒØªÛŒ Ø¯Ø§Ø®Ù„ÛŒ (Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø§Ø®Øª Ø¯Ø³ØªÛŒ)

      - name: âš™ï¸ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3 

      - name: ğŸ—ï¸ Build and Push PHP Docker Image
        uses: docker/build-push-action@v5
        with:
          context: . # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±ÛŒØ´Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡
          push: true # Ø§Ø±Ø³Ø§Ù„ ØªØµÙˆÛŒØ± Ø¨Ù‡ Ø±Ø¬ÛŒØ³ØªØ±ÛŒ
          tags: ${{ env.PHP_IMAGE_TAG }} # ØªÚ¯ ØªØµÙˆÛŒØ± Ù†Ù‡Ø§ÛŒÛŒ
          file: ./Dockerfile # Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Dockerfile
